<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>Family Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="Family Tracker - real-time location monitoring and perimeter alerts">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%230ea5e9' stroke-width='2'%3E%3Cpath d='M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z'/%3E%3Ccircle cx='12' cy='10' r='3'/%3E%3C/svg%3E">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css">
  <link rel="stylesheet" href="style.css?v=20260105a">
</head>
<body>
  <div class="container">
    <!-- Topbar s centrov√Ωmi date controls -->
    <div id="topbar" role="toolbar" aria-label="Ovl√°danie d√°tumu">
      <!-- ƒΩav√° strana: Site Switcher Widget with SSO -->
      <div class="topbar-left">
        <div class="site-nav" id="site-nav">
          <button class="site-nav-toggle" id="site-nav-toggle" aria-label="Prepn√∫≈• aplik√°ciu">
            <span id="site-nav-icon">üó∫Ô∏è</span>
            <span id="site-nav-name">Family Tracker</span>
            <svg class="site-nav-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="site-nav-menu hidden" id="site-nav-menu">
            <!-- Sites will be dynamically populated via JavaScript -->
            <div class="site-nav-loading">Naƒç√≠tavam...</div>
          </div>
        </div>
      </div>
      
      <!-- Stred: Date controls -->
      <div class="topbar-center">
        <button id="prevDay" aria-label="Predch√°dzaj√∫ci de≈à">‚óÄ</button>
        <button id="calendarToggle" aria-label="Otvori≈• kalend√°r">
          <span id="currentDate" aria-live="polite"></span>
          <span class="dropdown-icon">‚ñº</span>
        </button>
        <button id="nextDay" aria-label="Nasleduj√∫ci de≈à">‚ñ∂</button>
        <button id="today" aria-label="Dne≈°n√Ω de≈à">Dnes</button>
        
        <!-- Kalend√°r dropdown -->
        <div id="calendarDropdown" class="calendar-dropdown hidden">
          <div class="calendar-header">
            <button id="calPrevMonth" aria-label="Predch√°dzaj√∫ci mesiac">‚Äπ</button>
            <span id="calMonthYear"></span>
            <button id="calNextMonth" aria-label="Nasleduj√∫ci mesiac">‚Ä∫</button>
          </div>
          <div class="calendar-grid" id="calendarGrid"></div>
        </div>
      </div>
      
      <!-- Prav√° strana: Last Online + Battery + Hamburger -->
      <div class="topbar-right">
        <!-- User name (shown when logged in via SSO) -->
        <span id="userNameDisplay" class="user-name-display hidden"></span>

        <!-- Device selector dropdown -->
        <div id="deviceDropdownContainer" class="device-dropdown-container hidden">
          <button id="deviceDropdownBtn" class="device-dropdown-btn" aria-label="Vybra≈• zariadenia">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
              <line x1="12" y1="18" x2="12.01" y2="18"/>
            </svg>
            <span id="deviceDropdownLabel">1</span>
            <svg class="dropdown-arrow" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </button>
          <div id="deviceDropdownMenu" class="device-dropdown-menu hidden">
            <!-- Filled by JS -->
          </div>
        </div>

        <!-- Hamburger menu button + dropdown container -->
        <div class="hamburger-container">
          <button id="hamburgerBtn" class="hamburger-btn" aria-label="Otvori≈• menu">
            <span></span>
            <span></span>
            <span></span>
          </button>
          
          <!-- Hamburger menu dropdown -->
          <div id="hamburgerMenu" class="hamburger-menu hidden">
      <button class="menu-item" id="menuRefetch">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
          <path d="M3 3v5h5"/>
          <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
          <path d="M16 21h5v-5"/>
        </svg>
        Refetch de≈à
      </button>
      <div class="menu-submenu">
        <button class="menu-item menu-parent" id="menuIBeacons">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M8 12a4 4 0 0 1 8 0"/>
            <path d="M5 12a7 7 0 0 1 14 0"/>
            <path d="M2 12a10 10 0 0 1 20 0"/>
          </svg>
          Spr√°va iBeaconov
          <svg class="submenu-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
        </button>
        <div class="submenu-items hidden">
          <button class="menu-item submenu-item" id="menuManageIBeacons">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Prida≈• iBeacon
          </button>
          <button class="menu-item submenu-item" id="menuViewIBeacons">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="8" y1="6" x2="21" y2="6"/>
              <line x1="8" y1="12" x2="21" y2="12"/>
              <line x1="8" y1="18" x2="21" y2="18"/>
              <line x1="3" y1="6" x2="3.01" y2="6"/>
              <line x1="3" y1="12" x2="3.01" y2="12"/>
              <line x1="3" y1="18" x2="3.01" y2="18"/>
            </svg>
            Zoznam iBeaconov
          </button>
        </div>
      </div>
      <button class="menu-item" id="menuDevices">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
          <line x1="12" y1="18" x2="12.01" y2="18"/>
        </svg>
        Zariadenia
      </button>
      <button class="menu-item" id="menuPerimeters">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5"/>
          <line x1="12" y1="22" x2="12" y2="15.5"/>
          <polyline points="22 8.5 12 15.5 2 8.5"/>
        </svg>
        Perimeter z√≥ny
      </button>
      <button class="menu-item" id="menuSettings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
        Nastavenia
      </button>
    </div>
        </div> <!-- End hamburger-container -->
      </div> <!-- End topbar-right -->
    </div> <!-- End topbar -->

    <div class="map-wrap">
      <div id="map" role="region" aria-label="Mapa s trasou a polohami"></div>
    </div>

    <!-- Device tabs + table -->
    <div id="deviceTabsContainer" class="device-tabs-container hidden">
      <div id="deviceTabs" class="device-tabs"></div>
    </div>
    <div id="positionsTable" aria-live="polite">-</div>

    <footer class="site-footer">
      <p>&copy; 2025 Family Tracker</p>
    </footer>
  </div>

  <!-- iBeacon Management Overlay -->
  <div id="ibeaconOverlay" class="overlay hidden">
    <div class="overlay-content">
      <div class="overlay-header">
        <h2 id="overlayTitle">Prida≈• iBeacon</h2>
        <button id="overlayClose" class="overlay-close" aria-label="Zavrie≈•">&times;</button>
      </div>
      
      <div class="overlay-body">
        <!-- Form -->
        <form id="ibeaconForm" novalidate>
          <input type="hidden" id="beaconId" value="">
          
          <label for="beaconName">N√°zov
            <input type="text" id="beaconName" placeholder="N√°zov iBeaconu" autocomplete="off" required>
          </label>
          
          <label for="beaconMac">MAC adresa
            <input type="text" id="beaconMac" placeholder="AA:BB:CC:DD:EE:FF"
              inputmode="latin" autocomplete="off"
              pattern="^[0-9A-Fa-f]{2}(:?[0-9A-Fa-f]{2}){5}$"
              title="AA:BB:CC:DD:EE:FF" required>
          </label>
          
          <label for="beaconLat">≈†√≠rka (Latitude)
            <input type="number" id="beaconLat" placeholder="48.1486" step="0.000001" required>
          </label>
          
          <label for="beaconLng">Dƒ∫≈æka (Longitude)
            <input type="number" id="beaconLng" placeholder="17.1077" step="0.000001" required>
          </label>
          
          <div class="form-actions">
            <button type="button" id="selectOnMap" class="btn-secondary">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
              </svg>
              Vyber na mape
            </button>
            <button type="button" id="submit" class="btn-primary">Ulo≈æi≈•</button>
            <button type="button" id="cancelEdit" class="btn-secondary">Zru≈°i≈•</button>
          </div>
        </form>
        
        <!-- Map selector (hidden by default) -->
        <div id="mapSelector" class="map-selector hidden">
          <p class="map-help">Klikni na mape pre v√Ωber polohy iBeaconu</p>
          <div id="selectorMap"></div>
          <div class="map-actions">
            <button type="button" id="confirmLocation" class="btn-primary">Potvrdi≈• polohu</button>
            <button type="button" id="cancelMapSelect" class="btn-secondary">Zru≈°i≈•</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- iBeacon List Overlay -->
  <div id="ibeaconListOverlay" class="overlay hidden">
    <div class="overlay-content">
      <div class="overlay-header">
        <h2>Zoznam iBeaconov</h2>
        <button id="listOverlayClose" class="overlay-close" aria-label="Zavrie≈•">&times;</button>
      </div>

      <div class="overlay-body">
        <div id="ibeaconList" aria-live="polite">Naƒç√≠tavam...</div>
      </div>
    </div>
  </div>

  <!-- Settings Overlay -->
  <div id="settingsOverlay" class="overlay hidden">
    <div class="overlay-content settings-content">
      <div class="overlay-header">
        <h2>Nastavenia</h2>
        <button id="settingsOverlayClose" class="overlay-close" aria-label="Zavrie≈•">&times;</button>
      </div>

      <div class="overlay-body">
        <form id="settingsForm" novalidate>

          <!-- Settings Tabs Navigation -->
          <div class="settings-tabs">
            <button type="button" class="settings-tab active" data-tab="appearance">Vzhƒæad</button>
            <button type="button" class="settings-tab" data-tab="data-collection">Zber d√°t</button>
            <button type="button" class="settings-tab" data-tab="position-filtering">Filtrovanie</button>
            <button type="button" class="settings-tab" data-tab="geolocation">Geolok√°cia</button>
            <button type="button" class="settings-tab" data-tab="notifications">Notifik√°cie</button>
            <button type="button" class="settings-tab" data-tab="system">Syst√©m</button>
            <button type="button" class="settings-tab" data-tab="mac-management">MAC adresy</button>
          </div>

          <!-- ===== SEKCIA: VZHƒΩAD ===== -->
          <div class="settings-section open" data-section="appearance">
            <div class="settings-section-content">
              <div class="setting-group">
                <div class="setting-header">
                  <label><strong>Re≈æim zobrazenia</strong></label>
                </div>
                <div class="setting-description">
                  Vzhƒæad aplik√°cie - automaticky podƒæa nastavenia zariadenia, svetl√Ω alebo tmav√Ω re≈æim.
                </div>
                <div class="theme-toggle-group">
                  <label class="theme-option">
                    <input type="radio" name="theme" value="auto" checked>
                    <span class="theme-label">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                      </svg>
                      Auto
                    </span>
                  </label>
                  <label class="theme-option">
                    <input type="radio" name="theme" value="light">
                    <span class="theme-label">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                      </svg>
                      Svetl√Ω
                    </span>
                  </label>
                  <label class="theme-option">
                    <input type="radio" name="theme" value="dark">
                    <span class="theme-label">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                      </svg>
                      Tmav√Ω
                    </span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- ===== SEKCIA: ZBER D√ÅT ===== -->
          <div class="settings-section" data-section="data-collection">
            <div class="settings-section-content">
              <!-- Frekvencia be≈æn√©ho fetchu -->
              <div class="setting-group">
                <div class="setting-header">
                  <label for="fetchFrequencyMinutes">
                    <strong>Frekvencia be≈æn√©ho fetchu</strong>
                    <span class="setting-current" id="currentFetchFrequencyMinutes">‚Äî</span>
                  </label>
                  <button type="button" class="btn-default" data-setting="fetch_frequency_minutes" data-default="5">Predvolen√©</button>
                </div>
                <div class="setting-description">
                  Ako ƒçasto sa s≈•ahuj√∫ nov√© d√°ta zo SenseCAP.
                </div>
                <div class="setting-input-group">
                  <input type="number" id="fetchFrequencyMinutes" name="fetch_frequency_minutes" min="1" max="60" step="1" placeholder="5">
                  <span class="setting-unit">min</span>
                  <span class="setting-range">(1 ‚Äì 60)</span>
                </div>
              </div>

              <!-- Smart Refetch - Frekvencia -->
              <div class="setting-group">
                <div class="setting-header">
                  <label for="smartRefetchFrequencyMinutes">
                    <strong>Frekvencia Smart Refetch</strong>
                    <span class="setting-current" id="currentSmartRefetchFrequencyMinutes">‚Äî</span>
                  </label>
                  <button type="button" class="btn-default" data-setting="smart_refetch_frequency_minutes" data-default="30">Predvolen√©</button>
                </div>
                <div class="setting-description">
                  Ako ƒçasto sa kontroluje, ƒçi neboli oneskorene nahran√© d√°ta.
                </div>
                <div class="setting-input-group">
                  <input type="number" id="smartRefetchFrequencyMinutes" name="smart_refetch_frequency_minutes" min="5" max="1440" step="5" placeholder="30">
                  <span class="setting-unit">min</span>
                  <span class="setting-range">(5 ‚Äì 1440)</span>
                </div>
              </div>

              <!-- Smart Refetch - Poƒçet dn√≠ -->
              <div class="setting-group">
                <div class="setting-header">
                  <label for="smartRefetchDays">
                    <strong>Smart Refetch - obdobie</strong>
                    <span class="setting-current" id="currentSmartRefetchDays">‚Äî</span>
                  </label>
                  <button type="button" class="btn-default" data-setting="smart_refetch_days" data-default="7">Predvolen√©</button>
                </div>
                <div class="setting-description">
                  Koƒæko dn√≠ dozadu sa kontroluje ƒçi nepribudli nov√© z√°znamy.
                </div>
                <div class="setting-input-group">
                  <input type="number" id="smartRefetchDays" name="smart_refetch_days" min="1" max="30" step="1" placeholder="7">
                  <span class="setting-unit">dn√≠</span>
                  <span class="setting-range">(1 ‚Äì 30)</span>
                </div>
              </div>
            </div>
          </div>

          <!-- ===== SEKCIA: FILTROVANIE POZ√çCI√ç ===== -->
          <div class="settings-section" data-section="position-filtering">
            <div class="settings-section-content">
              <!-- Hyster√©za vzdialenosti -->
              <div class="setting-group">
                <div class="setting-header">
                  <label for="hysteresisMeters">
                    <strong>Minim√°lna vzdialenos≈•</strong>
                    <span class="setting-current" id="currentHysteresisMeters">‚Äî</span>
                  </label>
                  <button type="button" class="btn-default" data-setting="hysteresis_meters" data-default="50">Predvolen√©</button>
                </div>
                <div class="setting-description">
                  Minim√°lna vzdialenos≈• pre zaznamenanie novej polohy.
                </div>
                <div class="setting-input-group">
                  <input type="number" id="hysteresisMeters" name="hysteresis_meters" min="10" max="500" step="5" placeholder="50">
                  <span class="setting-unit">m</span>
                  <span class="setting-range">(10 ‚Äì 500)</span>
                </div>
              </div>

              <!-- Hyster√©za ƒçasu -->
              <div class="setting-group">
                <div class="setting-header">
                  <label for="hysteresisMinutes">
                    <strong>Minim√°lny ƒças</strong>
                    <span class="setting-current" id="currentHysteresisMinutes">‚Äî</span>
                  </label>
                  <button type="button" class="btn-default" data-setting="hysteresis_minutes" data-default="30">Predvolen√©</button>
                </div>
                <div class="setting-description">
                  Minim√°lny ƒçasov√Ω interval medzi z√°znamami polohy.
                </div>
                <div class="setting-input-group">
                  <input type="number" id="hysteresisMinutes" name="hysteresis_minutes" min="5" max="180" step="5" placeholder="30">
                  <span class="setting-unit">min</span>
                  <span class="setting-range">(5 ‚Äì 180)</span>
                </div>
              </div>

              <!-- Presnos≈• s√∫radn√≠c -->
              <div class="setting-group">
                <div class="setting-header">
                  <label for="uniquePrecision">
                    <strong>Presnos≈• s√∫radn√≠c</strong>
                    <span class="setting-current" id="currentUniquePrecision">‚Äî</span>
                  </label>
                  <button type="button" class="btn-default" data-setting="unique_precision" data-default="6">Predvolen√©</button>
                </div>
                <div class="setting-description">
                  Poƒçet desatinn√Ωch miest (6 = ~11 cm, 5 = ~1 m, 4 = ~11 m).
                </div>
                <div class="setting-input-group">
                  <input type="number" id="uniquePrecision" name="unique_precision" min="4" max="8" step="1" placeholder="6">
                  <span class="setting-unit">des. miest</span>
                  <span class="setting-range">(4 ‚Äì 8)</span>
                </div>
              </div>

              <!-- ƒåasov√Ω bucket -->
              <div class="setting-group">
                <div class="setting-header">
                  <label for="uniqueBucketMinutes">
                    <strong>ƒåasov√Ω interval zl√∫ƒçenia</strong>
                    <span class="setting-current" id="currentUniqueBucketMinutes">‚Äî</span>
                  </label>
                  <button type="button" class="btn-default" data-setting="unique_bucket_minutes" data-default="30">Predvolen√©</button>
                </div>
                <div class="setting-description">
                  Interval, v ktorom sa duplicitn√© polohy zl√∫ƒçia do jednej.
                </div>
                <div class="setting-input-group">
                  <input type="number" id="uniqueBucketMinutes" name="unique_bucket_minutes" min="5" max="180" step="5" placeholder="30">
                  <span class="setting-unit">min</span>
                  <span class="setting-range">(5 ‚Äì 180)</span>
                </div>
              </div>
            </div>
          </div>

          <!-- ===== SEKCIA: GEOLOK√ÅCIA ===== -->
          <div class="settings-section" data-section="geolocation">
            <div class="settings-section-content">
              <!-- Cache pre MAC adresy -->
              <div class="setting-group">
                <div class="setting-header">
                  <label for="macCacheMaxAgeDays">
                    <strong>Platnos≈• Wi-Fi cache</strong>
                    <span class="setting-current" id="currentMacCacheMaxAgeDays">‚Äî</span>
                  </label>
                  <button type="button" class="btn-default" data-setting="mac_cache_max_age_days" data-default="3600">Predvolen√©</button>
                </div>
                <div class="setting-description">
                  Poƒçet dn√≠, po ktor√© sa uchov√°vaj√∫ s√∫radnice Wi-Fi bodov v cache.
                </div>
                <div class="setting-input-group">
                  <input type="number" id="macCacheMaxAgeDays" name="mac_cache_max_age_days" min="1" max="7200" step="30" placeholder="3600">
                  <span class="setting-unit">dn√≠</span>
                  <span class="setting-range">(1 ‚Äì 7200)</span>
                </div>
              </div>

              <!-- Google Force -->
              <div class="setting-group">
                <div class="setting-header">
                  <label for="googleForce">
                    <strong>Vyn√∫ti≈• Google API</strong>
                    <span class="setting-current" id="currentGoogleForce">‚Äî</span>
                  </label>
                  <button type="button" class="btn-default" data-setting="google_force" data-default="0">Predvolen√©</button>
                </div>
                <div class="setting-description">
                  Ak zapnut√©, Wi-Fi lokaliz√°cie v≈ædy volaj√∫ Google API namiesto cache.
                </div>
                <div class="setting-input-group">
                  <div class="toggle-switch">
                    <input type="checkbox" id="googleForce" name="google_force">
                    <label for="googleForce" class="toggle-label">
                      <span class="toggle-inner"></span>
                      <span class="toggle-switch-text"></span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ===== SEKCIA: NOTIFIK√ÅCIE ===== -->
          <div class="settings-section" data-section="notifications">
            <div class="settings-section-content">
              <!-- Battery Alert Enable -->
              <div class="setting-group">
                <div class="setting-header">
                  <label>
                    <strong>Upozornenie na n√≠zku bat√©riu</strong>
                    <span class="setting-current" id="currentBatteryAlertEnabled">‚Äî</span>
                  </label>
                </div>
                <div class="setting-description">
                  Povoli≈• odosielanie emailov√Ωch notifik√°ci√≠ pri n√≠zkej √∫rovni bat√©rie trackera.
                </div>
                <div class="setting-input-group">
                  <div class="toggle-switch">
                    <input type="checkbox" id="batteryAlertEnabled" name="battery_alert_enabled">
                    <label for="batteryAlertEnabled" class="toggle-label">
                      <span class="toggle-inner"></span>
                      <span class="toggle-switch-text"></span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Battery Alert Email -->
              <div class="setting-group">
                <div class="setting-header">
                  <label for="batteryAlertEmail">
                    <strong>Email pre notifik√°cie o bat√©rii</strong>
                    <span class="setting-current" id="currentBatteryAlertEmail">‚Äî</span>
                  </label>
                </div>
                <div class="setting-description">
                  Emailov√° adresa, na ktor√∫ sa bud√∫ odosiela≈• upozornenia o n√≠zkej bat√©rii.
                </div>
                <div class="setting-input-group">
                  <input type="email" id="batteryAlertEmail" name="battery_alert_email" placeholder="email@example.com">
                </div>
              </div>
            </div>
          </div>

          <!-- ===== SEKCIA: SYST√âM ===== -->
          <div class="settings-section" data-section="system">
            <div class="settings-section-content">
              <!-- √örove≈à logovania -->
              <div class="setting-group">
                <div class="setting-header">
                  <label for="logLevel">
                    <strong>√örove≈à logovania</strong>
                    <span class="setting-current" id="currentLogLevel">‚Äî</span>
                  </label>
                  <button type="button" class="btn-default" data-setting="log_level" data-default="info">Predvolen√©</button>
                </div>
                <div class="setting-description">
                  Error = len chyby, Info = be≈æn√© udalosti, Debug = podrobn√© logovanie.
                </div>
                <div class="setting-input-group">
                  <select id="logLevel" name="log_level" class="setting-select">
                    <option value="error">Error - len chyby</option>
                    <option value="info">Info - be≈æn√© udalosti</option>
                    <option value="debug">Debug - podrobn√© logovanie</option>
                  </select>
                </div>
              </div>

              <!-- Prezeraƒç logov -->
              <div class="setting-group">
                <div class="setting-header">
                  <label><strong>Syst√©mov√© logy</strong></label>
                </div>
                <div class="setting-description">
                  Prezerajte a analyzujte syst√©mov√© logy a ≈°tatistiky.
                </div>
                <div class="setting-input-group">
                  <button type="button" id="openLogViewer" class="btn-secondary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                      <polyline points="14 2 14 8 20 8"/>
                      <line x1="16" y1="13" x2="8" y2="13"/>
                      <line x1="16" y1="17" x2="8" y2="17"/>
                      <polyline points="10 9 9 9 8 9"/>
                    </svg>
                    Otvori≈• prezeraƒç logov
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- MAC Address Management -->
          <div class="settings-section" data-section="mac-management">
            <div class="settings-section-content">
              <!-- Quick filter buttons -->
              <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap;">
                <button type="button" id="macFilterLast7Days" class="btn-secondary btn-small">Posledn√Ωch 7 dn√≠</button>
                <button type="button" id="macFilterClear" class="btn-secondary btn-small">Vyƒçisti≈• filter</button>
              </div>
              <!-- Filter controls -->
              <div class="mac-filter-controls" style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px;">
                <div class="form-field" style="flex:1;min-width:150px;">
                  <label for="macFilterSearch">Hƒæada≈• MAC</label>
                  <input type="text" id="macFilterSearch" placeholder="XX:XX:XX:XX:XX:XX">
                </div>
                <div class="form-field" style="flex:1;min-width:120px;">
                  <label for="macFilterType">Typ</label>
                  <select id="macFilterType">
                    <option value="no-coords">Bez s√∫radn√≠c</option>
                    <option value="with-coords">So s√∫radnicami</option>
                    <option value="all">V≈°etky</option>
                  </select>
                </div>
                <div class="form-field" style="flex:1;min-width:120px;">
                  <label for="macFilterDateFrom">Od d√°tumu</label>
                  <input type="date" id="macFilterDateFrom">
                </div>
                <div class="form-field" style="flex:1;min-width:120px;">
                  <label for="macFilterDateTo">Do d√°tumu</label>
                  <input type="date" id="macFilterDateTo">
                </div>
                <div class="form-field" style="align-self:flex-end;">
                  <button type="button" id="macFilterApply" class="btn-secondary btn-small">Filtrova≈•</button>
                </div>
              </div>

              <!-- MAC Table -->
              <div class="mac-management-container" style="max-height:300px;overflow-y:auto;border:1px solid var(--border);border-radius:8px;margin-bottom:15px;">
                <table class="mac-management-table" style="width:100%;">
                  <thead style="position:sticky;top:0;background:var(--bg-secondary);">
                    <tr>
                      <th style="width:30px;"><input type="checkbox" id="macSelectAll" title="Vybra≈• v≈°etky"></th>
                      <th class="sortable" data-sort="mac">MAC adresa</th>
                      <th class="sortable" data-sort="lat">Lat</th>
                      <th class="sortable" data-sort="lng">Lng</th>
                      <th class="sortable" data-sort="date">Posledn√© pou≈æitie</th>
                    </tr>
                  </thead>
                  <tbody id="macManagementBody">
                    <tr><td colspan="5" style="text-align:center;padding:20px;">Naƒç√≠tavam...</td></tr>
                  </tbody>
                </table>
              </div>

              <!-- Selected MAC info and map -->
              <div id="macSelectedInfo" style="display:none;margin-bottom:15px;">
                <h4 style="margin:0 0 10px 0;">Vybran√° MAC: <span id="macSelectedAddress" style="font-family:monospace;"></span></h4>
                <div style="display:flex;gap:15px;flex-wrap:wrap;">
                  <div style="flex:1;min-width:200px;">
                    <div class="form-row form-row-inline">
                      <div class="form-field">
                        <label for="macEditLat">Latitude</label>
                        <input type="number" id="macEditLat" step="0.000001" placeholder="48.1486">
                      </div>
                      <div class="form-field">
                        <label for="macEditLng">Longitude</label>
                        <input type="number" id="macEditLng" step="0.000001" placeholder="17.1077">
                      </div>
                    </div>
                    <button type="button" id="macSaveCoords" class="btn-primary btn-small" style="margin-top:10px;">Ulo≈æi≈• s√∫radnice</button>
                  </div>
                  <div style="flex:1;min-width:250px;">
                    <div id="macManagementMap" style="height:200px;border-radius:8px;"></div>
                  </div>
                </div>
              </div>

              <!-- Bulk actions -->
              <div class="mac-bulk-actions" style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
                <button type="button" id="macRetryGoogle" class="btn-secondary btn-small" disabled>
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                    <path d="M3 3v5h5"/>
                  </svg>
                  Sk√∫si≈• znova Google API (vybran√©)
                </button>
                <button type="button" id="macDeleteCoords" class="btn-reset btn-small" disabled>
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  </svg>
                  Zmaza≈• s√∫radnice (vybran√©)
                </button>
                <span id="macSelectedCount" style="align-self:center;color:var(--muted-text);font-size:0.9em;">0 vybran√Ωch</span>
              </div>
            </div>
          </div>

          <!-- Akƒçn√© tlaƒçidl√° -->
          <div class="form-actions">
            <button type="button" id="saveSettings" class="btn-primary">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                <polyline points="17 21 17 13 7 13 7 21"/>
                <polyline points="7 3 7 8 15 8"/>
              </svg>
              Ulo≈æi≈• nastavenia
            </button>
            <button type="button" id="cancelSettings" class="btn-secondary">Zru≈°i≈•</button>
            <button type="button" id="resetAllSettings" class="btn-reset">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
                <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
                <path d="M16 21h5v-5"/>
              </svg>
              Obnovi≈• v≈°etko na predvolen√©
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Perimeter Management Overlay -->
  <div id="perimeterOverlay" class="overlay hidden">
    <div class="overlay-content perimeter-content perimeter-content-wide">
      <div class="overlay-header">
        <h2 id="perimeterOverlayTitle">Perimeter z√≥ny</h2>
        <button id="perimeterOverlayClose" class="overlay-close" aria-label="Zavrie≈•">&times;</button>
      </div>

      <div class="overlay-body">
        <!-- Perimeter List View -->
        <div id="perimeterListView">
          <!-- Existing Perimeters Section -->
          <div class="perimeter-section">
            <div class="perimeter-section-header">
              <h3>Existuj√∫ce z√≥ny</h3>
              <button type="button" id="addNewPerimeter" class="btn-primary btn-small">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Prida≈• z√≥nu
              </button>
            </div>
            <div id="perimeterList" class="perimeter-list">
              <p class="perimeter-loading">Naƒç√≠tavam...</p>
            </div>
          </div>

          <!-- Test Email Section -->
          <div class="perimeter-section test-email-section">
            <h3>Test e-mailovej slu≈æby</h3>
            <p class="section-description">Overte, ƒçi je e-mailov√° slu≈æba spr√°vne nakonfigurovan√° odoslan√≠m testovacieho e-mailu.</p>
            <div class="test-email-form">
              <input type="email" id="testEmailAddress" placeholder="Zadajte e-mail pre test" autocomplete="email">
              <button type="button" id="sendTestEmail" class="btn-secondary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                  <polyline points="22,6 12,13 2,6"/>
                </svg>
                Odosla≈• test
              </button>
            </div>
            <p id="testEmailResult" class="test-email-result"></p>
          </div>
        </div>

        <!-- Perimeter Edit/Create View -->
        <div id="perimeterEditView" class="hidden">
          <form id="perimeterForm" novalidate>
            <input type="hidden" id="perimeterId" value="">

            <div class="perimeter-edit-layout">
              <!-- Left column: Form fields -->
              <div class="perimeter-edit-form">
                <div class="perimeter-section">
                  <h3>Z√°kladn√© √∫daje</h3>

                  <div class="form-row">
                    <label for="perimeterName">N√°zov perimetra</label>
                    <input type="text" id="perimeterName" placeholder="Napr. Domov, Pr√°ca, ≈†kola" autocomplete="off" required>
                  </div>

                  <div class="form-row">
                    <label for="perimeterColor">Farba z√≥ny</label>
                    <input type="color" id="perimeterColor" value="#ff6b6b">
                  </div>

                  <div class="form-row" id="perimeterDeviceRow">
                    <label for="perimeterDeviceId">Zariadenie</label>
                    <select id="perimeterDeviceId">
                      <option value="">V≈°etky zariadenia</option>
                    </select>
                  </div>
                </div>

                <!-- Multiple Emails Section -->
                <div class="perimeter-section">
                  <h3>E-mailov√© notifik√°cie</h3>
                  <p class="section-description">Pridajte e-maily, na ktor√© bud√∫ posielan√© upozornenia pri vstupe alebo opusten√≠ z√≥ny.</p>
                  <div id="perimeterEmailsList" class="perimeter-emails-list">
                    <!-- Email entries will be added here dynamically -->
                  </div>
                  <button type="button" id="addPerimeterEmail" class="btn-small btn-secondary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                      <line x1="12" y1="5" x2="12" y2="19"/>
                      <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Prida≈• e-mail
                  </button>
                </div>
              </div>

              <!-- Right column: Map with trail -->
              <div class="perimeter-edit-map">
                <div class="perimeter-section">
                  <div class="perimeter-map-header">
                    <h3>Nakresli≈• z√≥nu</h3>
                    <div class="trail-date-selector">
                      <label for="trailDate">Trasa d≈àa:</label>
                      <input type="date" id="trailDate">
                      <button type="button" id="loadTrailBtn" class="btn-small btn-secondary">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                          <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                          <path d="M3 3v5h5"/>
                        </svg>
                        Naƒç√≠ta≈•
                      </button>
                    </div>
                  </div>
                  <p class="map-help">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="12" y1="16" x2="12" y2="12"/>
                      <line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    Kliknut√≠m na mapu pridaj body polyg√≥nu. Prav√Ω klik odstr√°ni bod. Modr√° ƒçiara = trasa trackera.
                  </p>
                  <div id="perimeterDrawMap"></div>
                  <div class="polygon-info">
                    <span id="polygonPointCount">Body: 0</span>
                    <button type="button" id="clearPolygon" class="btn-small btn-secondary">Vymaza≈• polyg√≥n</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions perimeter-form-actions">
              <button type="button" id="cancelPerimeterEdit" class="btn-secondary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"/>
                  <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
                Zru≈°i≈•
              </button>
              <button type="button" id="savePerimeter" class="btn-primary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                  <polyline points="17 21 17 13 7 13 7 21"/>
                  <polyline points="7 3 7 8 15 8"/>
                </svg>
                Ulo≈æi≈• perimeter
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Log Viewer Overlay -->
  <div id="logViewerOverlay" class="overlay hidden">
    <div class="overlay-content log-viewer-content">
      <div class="overlay-header">
        <h2>Syst√©mov√© logy</h2>
        <button id="logViewerClose" class="overlay-close" aria-label="Zavrie≈•">&times;</button>
      </div>

      <div class="overlay-body">
        <!-- Statistics Section -->
        <div class="log-section log-stats-section">
          <div class="log-section-header">
            <h3>≈†tatistiky</h3>
            <div class="stats-period-selector">
              <label for="statsDays">Obdobie:</label>
              <select id="statsDays" class="stats-select">
                <option value="1">Posledn√Ω de≈à</option>
                <option value="7" selected>Posledn√Ωch 7 dn√≠</option>
                <option value="30">Posledn√Ωch 30 dn√≠</option>
                <option value="90">Posledn√Ωch 90 dn√≠</option>
              </select>
              <button type="button" id="refreshStats" class="btn-small btn-secondary" title="Obnovi≈• ≈°tatistiky">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                  <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                  <path d="M3 3v5h5"/>
                </svg>
              </button>
            </div>
          </div>
          <div id="logStats" class="log-stats-grid">
            <div class="stat-card">
              <div class="stat-icon stat-icon-fetch">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                  <path d="M3 3v5h5"/>
                </svg>
              </div>
              <div class="stat-value" id="statFetchRuns">-</div>
              <div class="stat-label">Fetch behy</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon stat-icon-google">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="2" y1="12" x2="22" y2="12"/>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                </svg>
              </div>
              <div class="stat-value" id="statGoogleCalls">-</div>
              <div class="stat-label">Google API volania</div>
              <div class="stat-detail" id="statGoogleDetail">-</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon stat-icon-positions">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                  <circle cx="12" cy="10" r="3"/>
                </svg>
              </div>
              <div class="stat-value" id="statPositions">-</div>
              <div class="stat-label">Vlo≈æen√© polohy</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon stat-icon-cache">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <ellipse cx="12" cy="5" rx="9" ry="3"/>
                  <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                  <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                </svg>
              </div>
              <div class="stat-value" id="statCacheHits">-</div>
              <div class="stat-label">Cache hity</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon stat-icon-ibeacon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M8 12a4 4 0 0 1 8 0"/>
                  <path d="M5 12a7 7 0 0 1 14 0"/>
                </svg>
              </div>
              <div class="stat-value" id="statIBeaconHits">-</div>
              <div class="stat-label">iBeacon hity</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon stat-icon-perimeter">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5"/>
                </svg>
              </div>
              <div class="stat-value" id="statPerimeterAlerts">-</div>
              <div class="stat-label">Perimeter alerty</div>
            </div>
            <div class="stat-card stat-card-wide">
              <div class="stat-icon stat-icon-logs">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                </svg>
              </div>
              <div class="stat-counts">
                <span class="log-count log-count-error"><span id="statErrorCount">-</span> ch√Ωb</span>
                <span class="log-count log-count-info"><span id="statInfoCount">-</span> info</span>
                <span class="log-count log-count-debug"><span id="statDebugCount">-</span> debug</span>
              </div>
              <div class="stat-label">Z√°znamy logov</div>
            </div>
          </div>
        </div>

        <!-- Log Viewer Section -->
        <div class="log-section log-viewer-section">
          <div class="log-section-header">
            <h3>Logy</h3>
            <div class="log-controls">
              <div class="log-filter-group">
                <select id="logLevelFilter" class="log-filter-select">
                  <option value="">V≈°etky √∫rovne</option>
                  <option value="error">Error</option>
                  <option value="info">Info</option>
                  <option value="debug">Debug</option>
                </select>
                <input type="text" id="logSearchFilter" class="log-search-input" placeholder="Hƒæada≈• v logoch...">
              </div>
              <div class="log-action-buttons">
                <button type="button" id="refreshLogs" class="btn-small btn-secondary" title="Obnovi≈• logy">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                    <path d="M3 3v5h5"/>
                  </svg>
                  Obnovi≈•
                </button>
                <button type="button" id="clearLogs" class="btn-small btn-reset" title="Vymaza≈• logy">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  </svg>
                  Vymaza≈•
                </button>
              </div>
            </div>
          </div>
          <div class="log-info-bar">
            <span id="logFileInfo">S√∫bor: -</span>
            <span id="logCountInfo">Z√°znamov: -</span>
          </div>
          <div id="logContainer" class="log-container">
            <div class="log-loading">Naƒç√≠tavam logy...</div>
          </div>
          <div class="log-pagination">
            <button type="button" id="logPrevPage" class="btn-small btn-secondary" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                <polyline points="15 18 9 12 15 6"/>
              </svg>
              Predo≈°l√©
            </button>
            <span id="logPageInfo">Strana 1</span>
            <button type="button" id="logNextPage" class="btn-small btn-secondary" disabled>
              ƒéal≈°ie
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Position Edit Modal -->
  <div id="positionEditOverlay" class="overlay hidden">
    <div class="overlay-content position-edit-content">
      <div class="overlay-header">
        <h2>Upravi≈• z√°znam polohy</h2>
        <button id="positionEditClose" class="overlay-close" aria-label="Zavrie≈•">&times;</button>
      </div>

      <div class="overlay-body">
        <form id="positionEditForm" novalidate>
          <input type="hidden" id="editPositionId" value="">

          <!-- Position Details (read-only info) -->
          <div class="position-edit-info">
            <div class="info-row">
              <span class="info-label">ID z√°znamu:</span>
              <span class="info-value" id="editPositionIdDisplay">‚Äî</span>
            </div>
            <div class="info-row">
              <span class="info-label">ƒåas z√°znamu:</span>
              <span class="info-value" id="editPositionTimestamp">‚Äî</span>
            </div>
            <div class="info-row">
              <span class="info-label">Zdroj:</span>
              <span class="info-value" id="editPositionSource">‚Äî</span>
            </div>
            <div class="info-row" id="editPrimaryMacRow" style="display:none;">
              <span class="info-label">Urƒçuj√∫ca MAC:</span>
              <span class="info-value" id="editPrimaryMac">‚Äî</span>
            </div>
            <div class="info-row" id="editAllMacsRow" style="display:none;">
              <span class="info-label">V≈°etky MAC:</span>
              <span class="info-value" id="editAllMacs" style="font-size:0.85em;word-break:break-all;">‚Äî</span>
            </div>
          </div>

          <!-- Current coordinates -->
          <div class="perimeter-section">
            <h3>Aktu√°lne s√∫radnice</h3>
            <div class="form-row form-row-inline">
              <div class="form-field">
                <label for="editCurrentLat">≈†√≠rka (Latitude)</label>
                <input type="number" id="editCurrentLat" step="0.000001" readonly>
              </div>
              <div class="form-field">
                <label for="editCurrentLng">Dƒ∫≈æka (Longitude)</label>
                <input type="number" id="editCurrentLng" step="0.000001" readonly>
              </div>
            </div>
          </div>

          <!-- New coordinates -->
          <div class="perimeter-section">
            <h3>Nov√© s√∫radnice</h3>
            <p class="section-description">Zadajte nov√© s√∫radnice manu√°lne alebo kliknut√≠m na mapu ni≈æ≈°ie.</p>
            <div class="form-row form-row-inline">
              <div class="form-field">
                <label for="editNewLat">≈†√≠rka (Latitude)</label>
                <input type="number" id="editNewLat" step="0.000001" placeholder="48.1486">
              </div>
              <div class="form-field">
                <label for="editNewLng">Dƒ∫≈æka (Longitude)</label>
                <input type="number" id="editNewLng" step="0.000001" placeholder="17.1077">
              </div>
            </div>
          </div>

          <!-- Mini map for coordinate selection -->
          <div class="perimeter-section">
            <h3>Mapa</h3>
            <p class="section-description">Kliknut√≠m na mapu vyberiete nov√© s√∫radnice. Modr√Ω marker = aktu√°lna poloha, ƒçerven√Ω = nov√° poloha.</p>
            <div id="positionEditMap"></div>
          </div>

          <!-- MAC History (only for WiFi positions with primary_mac) -->
          <div class="perimeter-section" id="macHistorySection" style="display: none;">
            <h3>Hist√≥ria tejto MAC adresy: <span id="macHistoryMacAddress" style="font-family:monospace;font-weight:normal;"></span></h3>
            <p class="section-description">Z√°znamy kde t√°to MAC urƒçila polohu. Oznaƒçte z√°znamy pre refetch.</p>
            <div id="macHistoryTable" class="mac-history-container">
              <table class="mac-history-table">
                <thead>
                  <tr>
                    <th style="width:30px;"><input type="checkbox" id="macHistorySelectAll" title="Vybra≈• v≈°etky"></th>
                    <th>D√°tum</th>
                    <th>ƒåas</th>
                    <th>S√∫radnice</th>
                  </tr>
                </thead>
                <tbody id="macHistoryBody">
                </tbody>
              </table>
            </div>
            <div class="mac-history-actions" style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
              <button type="button" id="refetchSelectedDays" class="btn-secondary btn-small" disabled>
                Refetch vybran√Ωch dn√≠
              </button>
              <button type="button" id="refetchAllMacDays" class="btn-secondary btn-small">
                Refetch v≈°etk√Ωch dn√≠ s touto MAC
              </button>
              <button type="button" id="testGoogleApiBtn" class="btn-secondary btn-small">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="2" y1="12" x2="22" y2="12"/>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                </svg>
                Sk√∫si≈• Google API
              </button>
            </div>

            <!-- Google API comparison result -->
            <div id="googleComparisonResult" class="google-comparison-result" style="display:none;margin-top:15px;padding:15px;background:var(--muted-bg);border-radius:8px;border:1px solid var(--border);">
              <h4 style="margin:0 0 10px 0;">Porovnanie s√∫radn√≠c</h4>
              <div class="comparison-table" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:15px;">
                <div>
                  <strong style="font-size:12px;color:var(--muted-text);">Zdroj</strong>
                </div>
                <div>
                  <strong style="font-size:12px;color:var(--muted-text);">Latitude</strong>
                </div>
                <div>
                  <strong style="font-size:12px;color:var(--muted-text);">Longitude</strong>
                </div>
                <div>Cache (aktu√°lna)</div>
                <div id="compCacheLat" style="font-family:monospace;">-</div>
                <div id="compCacheLng" style="font-family:monospace;">-</div>
                <div>Google API</div>
                <div id="compGoogleLat" style="font-family:monospace;">-</div>
                <div id="compGoogleLng" style="font-family:monospace;">-</div>
                <div>Rozdiel</div>
                <div id="compDiffLat" style="font-family:monospace;font-size:12px;">-</div>
                <div id="compDiffLng" style="font-family:monospace;font-size:12px;">-</div>
              </div>
              <div id="compDistance" style="margin-bottom:15px;font-size:14px;"></div>
              <div class="comparison-actions" style="display:flex;gap:8px;">
                <button type="button" id="acceptGoogleCoords" class="btn-primary btn-small">
                  Akceptova≈• Google s√∫radnice
                </button>
                <button type="button" id="rejectGoogleCoords" class="btn-secondary btn-small">
                  Zamietnu≈•
                </button>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="form-actions position-edit-actions">
            <button type="button" id="savePositionEdit" class="btn-primary">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                <polyline points="17 21 17 13 7 13 7 21"/>
                <polyline points="7 3 7 8 15 8"/>
              </svg>
              Ulo≈æi≈• zmeny
            </button>
            <button type="button" id="invalidateMac" class="btn-reset" style="display: none;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
              </svg>
              Zneplatni≈• MAC cache
            </button>
            <button type="button" id="cancelPositionEdit" class="btn-secondary">Zru≈°i≈•</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Device Management Overlay -->
  <div id="deviceManagementOverlay" class="overlay hidden">
    <div class="overlay-content overlay-wide">
      <div class="overlay-header">
        <h2>Spr√°va zariaden√≠</h2>
        <button class="overlay-close-btn" onclick="closeDeviceManagement()">&times;</button>
      </div>
      <div class="overlay-body">
        <div id="deviceList"></div>
        <div class="overlay-actions" style="margin-top:16px;">
          <button class="btn-primary" onclick="openDeviceForm()">Prida≈• zariadenie</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Device Form (inline within management overlay) -->
  <div id="deviceForm" class="overlay hidden">
    <div class="overlay-content">
      <div class="overlay-header">
        <h2 id="deviceFormTitle">Nov√© zariadenie</h2>
        <button class="overlay-close-btn" onclick="closeDeviceForm()">&times;</button>
      </div>
      <div class="overlay-body">
        <input type="hidden" id="deviceId">
        <div class="form-group">
          <label for="deviceName">N√°zov zariadenia</label>
          <input type="text" id="deviceName" placeholder="Napr. Tracker Fido" required>
        </div>
        <div class="form-group">
          <label for="deviceEui">Device EUI</label>
          <input type="text" id="deviceEui" placeholder="Napr. 2CF7F1C0443.." required>
        </div>
        <div class="form-group">
          <label for="deviceColor">Farba na mape</label>
          <input type="color" id="deviceColor" value="#3388ff">
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="deviceActive" checked>
            Akt√≠vne zariadenie
          </label>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="deviceNotifEnabled">
            Notifik√°cie zapnut√©
          </label>
        </div>
        <div class="form-group">
          <label for="deviceNotifEmail">Email pre notifik√°cie</label>
          <input type="email" id="deviceNotifEmail" placeholder="email@example.com">
        </div>
        <div class="form-actions">
          <button class="btn-primary" onclick="saveDevice()">Ulo≈æi≈•</button>
          <button class="btn-secondary" onclick="closeDeviceForm()">Zru≈°i≈•</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Device Perimeter Overlay -->
  <div id="devicePerimeterOverlay" class="overlay hidden">
    <div class="overlay-content overlay-wide">
      <div class="overlay-header">
        <h2>Perimeter z√≥ny zariadenia</h2>
        <button class="overlay-close-btn" onclick="closeDevicePerimeterManager()">&times;</button>
      </div>
      <div class="overlay-body">
        <!-- Content injected by JS -->
      </div>
    </div>
  </div>

  <!-- Device Perimeter Form -->
  <div id="devicePerimeterForm" class="overlay hidden">
    <div class="overlay-content">
      <div class="overlay-header">
        <h2 id="dpFormTitle">Nov√Ω perimeter</h2>
        <button class="overlay-close-btn" onclick="closeDevicePerimeterForm()">&times;</button>
      </div>
      <div class="overlay-body">
        <input type="hidden" id="dpId">
        <input type="hidden" id="dpDeviceId">
        <div class="form-group">
          <label for="dpName">N√°zov perimetra</label>
          <input type="text" id="dpName" placeholder="Napr. Domov" required>
        </div>
        <div class="form-group">
          <label for="dpLat">Zemepisn√° ≈°√≠rka</label>
          <input type="number" id="dpLat" step="0.000001" placeholder="48.1486" required>
        </div>
        <div class="form-group">
          <label for="dpLng">Zemepisn√° dƒ∫≈æka</label>
          <input type="number" id="dpLng" step="0.000001" placeholder="17.1077" required>
        </div>
        <div class="form-group">
          <label for="dpRadius">Polomer (m)</label>
          <input type="number" id="dpRadius" min="10" max="50000" value="500">
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="dpAlertEnter">
            Upozornenie pri vstupe
          </label>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="dpAlertExit">
            Upozornenie pri v√Ωstupe
          </label>
        </div>
        <div class="form-actions">
          <button class="btn-primary" onclick="saveDevicePerimeter()">Ulo≈æi≈•</button>
          <button class="btn-secondary" onclick="closeDevicePerimeterForm()">Zru≈°i≈•</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script src="app.js?v=20260105a" defer></script>
</body>
</html>
