<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>Tracker - denné úseky</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- Topbar s centrovými date controls -->
    <div id="topbar" role="toolbar" aria-label="Ovládanie dátumu">
      <!-- Ľavá strana: prázdna (pre vycentrovanie) -->
      <div class="topbar-left"></div>
      
      <!-- Stred: Date controls -->
      <div class="topbar-center">
        <button id="prevDay" aria-label="Predchádzajúci deň">◀</button>
        <button id="calendarToggle" aria-label="Otvoriť kalendár">
          <span id="currentDate" aria-live="polite"></span>
          <span class="dropdown-icon">▼</span>
        </button>
        <button id="nextDay" aria-label="Nasledujúci deň">▶</button>
        <button id="today" aria-label="Dnešný deň">Dnes</button>
        
        <!-- Kalendár dropdown -->
        <div id="calendarDropdown" class="calendar-dropdown hidden">
          <div class="calendar-header">
            <button id="calPrevMonth" aria-label="Predchádzajúci mesiac">‹</button>
            <span id="calMonthYear"></span>
            <button id="calNextMonth" aria-label="Nasledujúci mesiac">›</button>
          </div>
          <div class="calendar-grid" id="calendarGrid"></div>
        </div>
      </div>
      
      <!-- Pravá strana: Last Online + Battery + Hamburger -->
      <div class="topbar-right">
        <!-- Last online info -->
        <div id="lastOnlineInfo" class="last-online-info" title="Posledný update">
          <svg class="clock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <span id="lastOnlineText">-</span>
        </div>
        
        <!-- Battery indicator -->
        <div id="batteryIndicator" class="battery-indicator" title="Stav batérie">
          <svg class="battery-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="7" width="18" height="10" rx="1"></rect>
            <path d="M20 10v4"></path>
          </svg>
          <span id="batteryText" class="battery-text">-</span>
        </div>
        
        <!-- Hamburger menu button + dropdown container -->
        <div class="hamburger-container">
          <button id="hamburgerBtn" class="hamburger-btn" aria-label="Otvoriť menu">
            <span></span>
            <span></span>
            <span></span>
          </button>
          
          <!-- Hamburger menu dropdown -->
          <div id="hamburgerMenu" class="hamburger-menu hidden">
      <button class="menu-item" id="menuRefetch">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
          <path d="M3 3v5h5"/>
          <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
          <path d="M16 21h5v-5"/>
        </svg>
        Refetch deň
      </button>
      <button class="menu-item" id="menuManageIBeacons">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
          <circle cx="12" cy="10" r="3"/>
        </svg>
        Pridať iBeacon
      </button>
      <button class="menu-item" id="menuViewIBeacons">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
        Zoznam iBeaconov
      </button>
    </div>
        </div> <!-- End hamburger-container -->
      </div> <!-- End topbar-right -->
    </div> <!-- End topbar -->

    <div class="map-wrap">
      <div id="map" role="region" aria-label="Mapa s trasou a polohami"></div>
    </div>

    <!-- Tabuľka časových úsekov -->
    <div id="positionsTable" aria-live="polite">-</div>

    <footer class="site-footer">
      <p>&copy; 2025 Tracker</p>
    </footer>
  </div>

  <!-- iBeacon Management Overlay -->
  <div id="ibeaconOverlay" class="overlay hidden">
    <div class="overlay-content">
      <div class="overlay-header">
        <h2 id="overlayTitle">Pridať iBeacon</h2>
        <button id="overlayClose" class="overlay-close" aria-label="Zavrieť">&times;</button>
      </div>
      
      <div class="overlay-body">
        <!-- Form -->
        <form id="ibeaconForm" novalidate>
          <input type="hidden" id="beaconId" value="">
          
          <label for="beaconName">Názov
            <input type="text" id="beaconName" placeholder="Názov iBeaconu" autocomplete="off" required>
          </label>
          
          <label for="beaconMac">MAC adresa
            <input type="text" id="beaconMac" placeholder="AA:BB:CC:DD:EE:FF"
              inputmode="latin" autocomplete="off"
              pattern="^[0-9A-Fa-f]{2}(:?[0-9A-Fa-f]{2}){5}$"
              title="AA:BB:CC:DD:EE:FF" required>
          </label>
          
          <label for="beaconLat">Šírka (Latitude)
            <input type="number" id="beaconLat" placeholder="48.1486" step="0.000001" required>
          </label>
          
          <label for="beaconLng">Dĺžka (Longitude)
            <input type="number" id="beaconLng" placeholder="17.1077" step="0.000001" required>
          </label>
          
          <div class="form-actions">
            <button type="button" id="selectOnMap" class="btn-secondary">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
              </svg>
              Vyber na mape
            </button>
            <button type="button" id="submit" class="btn-primary">Uložiť</button>
            <button type="button" id="cancelEdit" class="btn-secondary">Zrušiť</button>
          </div>
        </form>
        
        <!-- Map selector (hidden by default) -->
        <div id="mapSelector" class="map-selector hidden">
          <p class="map-help">Klikni na mape pre výber polohy iBeaconu</p>
          <div id="selectorMap"></div>
          <div class="map-actions">
            <button type="button" id="confirmLocation" class="btn-primary">Potvrdiť polohu</button>
            <button type="button" id="cancelMapSelect" class="btn-secondary">Zrušiť</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- iBeacon List Overlay -->
  <div id="ibeaconListOverlay" class="overlay hidden">
    <div class="overlay-content">
      <div class="overlay-header">
        <h2>Zoznam iBeaconov</h2>
        <button id="listOverlayClose" class="overlay-close" aria-label="Zavrieť">&times;</button>
      </div>
      
      <div class="overlay-body">
        <div id="ibeaconList" aria-live="polite">Načítavam...</div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="app.js" defer></script>
</body>
</html>
