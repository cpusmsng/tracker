# GPS/Location Tracker - Environment Configuration
# Copy this file to .env and fill in your values
#
# Usage:
#   cp .env.example .env
#   nano .env  # Edit values
#   docker compose up -d

# =============================================================================
# REQUIRED CONFIGURATION
# =============================================================================

# SenseCAP API Credentials (get from SenseCAP console)
SENSECAP_ACCESS_ID=your_access_id_here
SENSECAP_ACCESS_KEY=your_access_key_here
SENSECAP_DEVICE_EUI=your_device_eui_here

# =============================================================================
# OPTIONAL CONFIGURATION (defaults shown)
# =============================================================================

# Port to expose the tracker application
TRACKER_PORT=8080

# SenseCAP Settings
SENSECAP_CHANNEL_INDEX=1
SENSECAP_LIMIT=50

# Measurement IDs (SenseCAP specific)
MEAS_WIFI_MAC=5001
MEAS_BT_IBEACON_MAC=5002
MEAS_GNSS_LON=4197
MEAS_GNSS_LAT=4198

# Hysteresis Settings (position deduplication)
# HYSTERESIS_METERS: Minimum distance between recorded positions
# HYSTERESIS_MINUTES: Minimum time between positions at same location
HYSTERESIS_METERS=50
HYSTERESIS_MINUTES=30
UNIQUE_PRECISION=6
UNIQUE_BUCKET_MINUTES=30
MAC_CACHE_MAX_AGE_DAYS=3600

# Google Geolocation API (required for Wi-Fi positioning)
# Get API key from: https://console.cloud.google.com/apis/credentials
GOOGLE_API_KEY=
GOOGLE_FORCE=0

# Security - PIN Access
# Default PIN is 1234 - CHANGE THIS IN PRODUCTION!
# Generate hash: echo -n "your_pin" | sha256sum
ACCESS_PIN_HASH=03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4

# Email Service (for perimeter alerts)
# URL to HTTP email service endpoint
EMAIL_SERVICE_URL=
EMAIL_API_KEY=
EMAIL_FROM=tracker@example.com
EMAIL_FROM_NAME=Tracker Alert

# Battery Alert Settings
# Set BATTERY_ALERT_ENABLED=true to receive email when battery is low
BATTERY_ALERT_ENABLED=false
BATTERY_ALERT_EMAIL=

# N8N Integration (optional - legacy, prefer using new API auth)
# If set, n8n_* API endpoints require this key (fallback for backwards compatibility)
N8N_API_KEY=

# =============================================================================
# API AUTHENTICATION (2-tier system)
# =============================================================================
#
# Authentication flow:
# 1. TRUST_DOCKER_NETWORK=true && IP is 172.x.x.x / 10.x.x.x? → Allow without auth
# 2. Validate via family-office POST /api/tokens/validate → Allow if valid
#
# Environment variables:
# - TRUST_DOCKER_NETWORK: true = allow requests from Docker network without auth
# - INTERNAL_API_KEY: Shared key for communication with family-office
# - SUBDOMAIN_NAME: Name of this subdomain for token validation

# Trust requests from Docker network (172.x.x.x, 10.x.x.x) without API key
# Use this for n8n and other internal services on the same Docker network
TRUST_DOCKER_NETWORK=true

# Internal API key for family-office communication
# Must match the key configured in family-office
INTERNAL_API_KEY=

# Subdomain name for token validation (used in /api/tokens/validate)
SUBDOMAIN_NAME=tracker

# Logging Configuration
# LOG_LEVEL: error, info, debug (default: info)
#   error - Only errors
#   info  - Errors + important info (fetch start/end, counts)
#   debug - Everything including detailed processing info
LOG_LEVEL=info

# LOG_FILE: Path to the log file
# In Docker: defaults to /var/log/tracker/fetch.log
# Locally: defaults to ./fetch.log (in app directory)
# LOG_FILE=/var/log/tracker/fetch.log

# Fetch Settings
# FETCH_FREQUENCY_MINUTES: How often to run regular fetch (default: 5)
# Cron runs every minute, script checks if enough time has passed since last run
FETCH_FREQUENCY_MINUTES=5

# Smart Refetch Settings
# SMART_REFETCH_FREQUENCY_MINUTES: How often to run smart refetch (default: 30)
# SMART_REFETCH_DAYS: How many days back to check for missing data (default: 7)
SMART_REFETCH_FREQUENCY_MINUTES=30
SMART_REFETCH_DAYS=7

# Application URL (for email links)
# Set to your tracker's public URL (used in email alert buttons)
TRACKER_APP_URL=https://tracker.example.com

# SSO Authentication (optional)
# Set SSO_ENABLED=true to use SSO instead of PIN
# Requires connection to bagron.eu auth server via bagron-network
SSO_ENABLED=false
AUTH_API_URL=http://family-office:3001
LOGIN_URL=https://bagron.eu/login
